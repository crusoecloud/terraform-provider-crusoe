include:
  - project: 'crusoeenergy/tools'
    file: '/templates/go.gitlab-ci.yml'

test_and_lint:
  rules:
    - if: '$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH || $CI_COMMIT_BRANCH == "release"'
      changes: !reference [.code-changes, changes]
    - if: '$CI_MERGE_REQUEST_ID'
      changes: !reference [.code-changes, changes]
    # don't run CI for semver tags, do run it for custom tags
    - if: '$CI_COMMIT_TAG && $CI_COMMIT_TAG !~ /^(.+\/)?v[0-9]+\.[0-9]+\.[0-9]+$/'